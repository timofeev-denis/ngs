steal("jquery/controller",function($){$.Controller("CE.Shortcode",{listensTo:["render"],preloaderClass:"motopress-small-preload"},{group:null,isGrid:false,shortcodeName:null,shortcode:null,child:null,init:function(el,args){this.group=el.attr("data-motopress-group");this.isGrid=(this.group===CE.LeftBar.myThis.library.mp_grid.id);this.shortcodeName=el.attr("data-motopress-shortcode");this.shortcode=el;if(!this.isGrid){this.child=this.shortcode.children("div")}},renderShortcode:function(isNew){if(!this.isGrid){isNew=(typeof isNew==="undefined"||!isNew)?false:true;var $this=this;var handle=this.element.parent("."+CE.DragDrop.myThis.blockContent.attr("class")).next("."+CE.DragDrop.myThis.helper.attr("class")).children("."+CE.DragDrop.myThis.dragHandle.attr("class"));handle.addClass(CE.Shortcode.preloaderClass);var closeType=this.element.attr("data-motopress-close-type");var wrapRender=(typeof this.element.attr("data-motopress-wrap-render")!=="undefined")?this.element.attr("data-motopress-wrap-render"):null;var parameters=(typeof this.element.attr("data-motopress-parameters")!=="undefined")?this.element.attr("data-motopress-parameters"):null;var styles=(typeof this.element.attr("data-motopress-styles")!=="undefined")?this.element.attr("data-motopress-styles"):null;if(isNew&&parameters){parameters=this.setDefaultAttrs(parameters)}if(isNew&&styles){styles=this.setDefaultStyle(styles)}var content=(typeof this.element.attr("data-motopress-content")!=="undefined")?this.element.attr("data-motopress-content").replace(/\[\]/g,"["):null;if(typeof this.element.attr("data-motopress-active-item")!=="undefined"){var JSONParameters=$.parseJSON(parameters);JSONParameters.active={value:this.element.attr("data-motopress-active-item")};parameters=JSON.stringify(JSONParameters)}$.ajax({url:parent.motopress.ajaxUrl,type:"POST",dataType:"html",data:{action:"motopress_ce_render_shortcode",nonce:parent.motopressCE.nonces.motopress_ce_render_shortcode,postID:parent.motopressCE.postID,closeType:closeType,shortcode:$this.shortcodeName,wrapRender:wrapRender,parameters:parameters,styles:styles,content:content},success:function(data){var span=$this.element.closest('[class*="span"].motopress-span');if(!span.parent(".motopress-content-wrapper > .mp-row-fluid.motopress-row").length){var handleMiddleLast=span.parent(".mp-row-fluid.motopress-row").nextAll(".motopress-handle-middle-in:last");var minHeight=parseInt(handleMiddleLast.css("min-height"));handleMiddleLast.height(minHeight)}$(".motopress-content-wrapper > .motopress-handle-middle-in:last").height("");$this.element.html(data);$this.child=$this.element.children("div");var images=$this.shortcode.find("img");var imgCount=images.length,count=0;if(imgCount){images.on("load",function(){count++;if(count===imgCount){$this.element.trigger("render")}})}if(isNew){switch($this.shortcodeName){case"mp_tabs":$this.settingsForms.find('> [data-motopress-parameter="tabs"] > .motopress-property-group > .motopress-property-button-wrapper > .motopress-property-button-default').trigger("click",CE.LeftBar.myThis.library[$this.group].objects[$this.shortcodeName].parameters.tabs.items.count);break;case"mp_accordion":$this.settingsForms.find('> [data-motopress-parameter="accordionItems"] > .motopress-property-group > .motopress-property-button-wrapper > .motopress-property-button-default').trigger("click",CE.LeftBar.myThis.library[$this.group].objects[$this.shortcodeName].parameters.accordionItems.items.count);break}}$this.element.trigger("render");handle.removeClass(CE.Shortcode.preloaderClass);parent.CE.Save.changeContent()},error:function(jqXHR){var error=$.parseJSON(jqXHR.responseText);if(error.debug){console.log(error.message)}else{parent.MP.Flash.setFlash(error.message,"error");parent.MP.Flash.showMessage()}handle.removeClass(CE.Shortcode.preloaderClass)}})}},setDefaultAttrs:function(parameters,childShortcode){var JSONParameters=$.parseJSON(parameters);var generalAttrs=this.getGeneralAttrs(childShortcode);var $this=this;$.each(JSONParameters,function(name,values){if(typeof values.value==="undefined"||!values.value){if(typeof childShortcode!=="undefined"&&childShortcode.attr("data-motopress-shortcode")==="mp_tab"&&name==="id"){values.value=parent.MP.Utils.uniqid()}else{if(generalAttrs[name].hasOwnProperty("saveInContent")&&generalAttrs[name].saveInContent==="true"){var shortcode=(typeof childShortcode==="undefined")?$this.shortcode:childShortcode;shortcode.attr("data-motopress-content",generalAttrs[name]["default"])}else{values.value=generalAttrs[name]["default"]}}}});this.setShortcodeAttrs(JSONParameters,childShortcode);return JSON.stringify(JSONParameters)},setDefaultStyle:function(style){if(typeof style==="undefined"){style=this.element.attr("data-motopress-styles")}var JSONStyle=$.parseJSON(style);var styles=(this.isGrid)?CE.Style.gridProps:CE.Style.props;$.extend(true,styles,CE.LeftBar.myThis.library[this.group].objects[this.shortcodeName].styles,styles);var $this=this;$.each(JSONStyle,function(name,values){if(typeof values.value==="undefined"||!values.value){var defaultVal=styles[name]["default"];switch(styles[name].type){case"margin":var allNone=true;$.each(styles[name]["default"],function(i,val){if(val!==styles[name].values[0]){allNone=false}});defaultVal=(allNone)?"":defaultVal.join(",");break;case"select2":var defaultClassesList=[];if(CE.LeftBar.myThis.library[$this.group].objects[$this.shortcodeName].styles.mp_style_classes.hasOwnProperty("default")){$.each(CE.LeftBar.myThis.library[$this.group].objects[$this.shortcodeName].styles.mp_style_classes["default"],function(i,v){defaultClassesList.push(v)})}defaultVal=defaultClassesList.join(" ");break}values.value=defaultVal}});this.setShortcodeStyle(JSONStyle);return JSON.stringify(JSONStyle)}})});