steal("jquery/controller",function($){$.Controller("CE.Ctrl",{processValue:function(value,defaultValue,isNew){value=(typeof isNew!=="undefined"&&isNew&&typeof value==="undefined")?defaultValue:value;if(!value){value=""}return String(value)}},{name:null,dependency:false,isChild:false,disabled:false,isStyle:false,init:function(el,args){this.name=args.name;if(args.hasOwnProperty("dependency")){this.dependency=args.dependency}if(args.hasOwnProperty("isChild")){this.isChild=args.isChild}if(args.hasOwnProperty("disabled")){this.disabled=(args.disabled==="true")}if(args.hasOwnProperty("isStyle")){this.isStyle=args.isStyle}},get:function(){},set:function(){},change:function(el,e){if(!this.isChild){var $this=this;var dependencyCtrl=null;CE.Dialog.myThis.settingsTab.find('> .motopress-settings-forms > [data-motopress-parameter] > .motopress-controls, > .motopress-settings-forms > [data-motopress-parameter] > :not(".motopress-property-label, .motopress-property-description, hr") > .motopress-controls').each(function(){dependencyCtrl=$(this).controller();if(dependencyCtrl.dependency){if($this.name===dependencyCtrl.dependency.parameter){if($this.get()!=dependencyCtrl.dependency.value){$(this).closest("[data-motopress-parameter]").addClass("motopress-hide")}else{$(this).closest("[data-motopress-parameter]").removeClass("motopress-hide")}}}})}var controls=CE.Dialog.myThis.shortcode.controller(CE.Controls);(this.isStyle)?controls.saveStyle(this):controls.saveSettings(this)}});CE.Ctrl("CE.CtrlInput",{},{get:function(){return this.element.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.val(value)}});CE.Ctrl("CE.CtrlSpinner",{listensTo:["customize"]},{min:null,max:null,step:1,init:function(el,args){this._super(el,args);if(args.hasOwnProperty("min")){this.min=args.min}if(args.hasOwnProperty("max")){this.max=args.max}if(args.hasOwnProperty("step")){this.step=args.step}},customize:function(el,e){var $this=this;el.spinner({disabled:this.disabled,min:this.min,max:this.max,step:this.step,spin:function(event,ui){var oldValue=$this.get();var t=setTimeout(function(){el.trigger("change",oldValue);clearTimeout(t)},0)}})},change:function(el,e,oldValue){var value=this.get();if(value!==null&&oldValue!==value&&value>=this.min&&value<=this.max&&value%this.step===0){CE.Ctrl.prototype.change.apply(this,[el,e])}},get:function(){return this.element.spinner("value")},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);if(typeof this.element.data("uiSpinner")!=="undefined"){this.element.spinner("value",value)}else{this.element.val(value)}}});CE.Ctrl("CE.CtrlLink",{},{get:function(){return $(".motopress-property-link-input",this.element).val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);$(".motopress-property-link-input",this.element).val(value)},".motopress-property-button-default click":function(el){var input=$(".motopress-property-link-input",this.element);CE.Link.myThis.open(input,{title:false,target:false},function(atts){if(input.val==atts.href){return}input.val(atts.href);input.trigger("change")},CE.Link.myThis.wpCancelButtonHandler);return false}});CE.Ctrl("CE.CtrlTextarea",{},{get:function(){return this.element.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.val(value)}});CE.Ctrl("CE.CtrlTextarea64",{},{get:function(){return parent.MP.Utils.base64_encode(this.element.val())},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.val(parent.MP.Utils.base64_decode(value))}});CE.Ctrl("CE.CtrlTextareaTable",{},{get:function(){var value=parent.MP.Utils.nl2br(this.element.val());return value},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);value=value.replace(new RegExp("^<p>"),"").replace(new RegExp("</p>$"),"");value=parent.MP.Utils.br2nl(value);this.element.val(value)}});CE.Ctrl("CE.CtrlTextareaTinymce",{},{textarea:null,currentShortcode:null,init:function(el,args){this._super(el,args);this.textarea=el.children(".motopress-property-textarea");this.currentShortcode=args.currentShortcode},get:function(){return this.textarea.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.textarea.val(value)},".motopress-property-button-default click":function(el,e){var editor=parent.CE.CodeModal.myThis.editor;parent.CE.CodeModal.currentShortcode=this.currentShortcode;parent.CE.CodeModal.currentTextareaTinymce=this.element;var content=this.get();if(content.length){if(editor!==null){editor.setContent(content,{format:"html"})}parent.CE.CodeModal.myThis.content.val(content)}parent.CE.CodeModal.myThis.saveHandler=this.saveHandler;parent.CE.CodeModal.myThis.element.data("modal").closeDialog=false;parent.CE.CodeModal.myThis.element.modal("show")},saveHandler:function(e){var $this=parent.CE.CodeModal.myThis;$this.switchVisual();var controller=parent.CE.CodeModal.currentTextareaTinymce.controller();var content=$this.editor.getContent({format:"html"});if(content.length){controller.set(content);parent.CE.CodeModal.currentTextareaTinymce.trigger("change")}$this.element.modal("hide")}});CE.Ctrl("CE.CtrlAudio",{},{init:function(el,args){this._super(el,args);$(".motopress-property-audio-title",this.element).val(args.audioTitle).attr("disabled","disabled")},get:function(){var audioTitle=$(".motopress-property-audio-id",this.element).val();return audioTitle},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);$(".motopress-property-audio-id",this.element).val(value)},".motopress-property-button-default click":function(el){CE.WPAudio.myThis.frame.open(this)}});CE.Ctrl("CE.CtrlMediaVideo",{},{init:function(el,args){this._super(el,args);$(".motopress-property-video-title",this.element).val(args.videoTitle).attr("disabled","disabled")},get:function(){var videoTitle=$(".motopress-property-video-id",this.element).val();return videoTitle},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);$(".motopress-property-video-id",this.element).val(value)},".motopress-property-button-default click":function(el){CE.WPVideo.myThis.frame.open(this)}});CE.Ctrl("CE.CtrlImageGeneral",{listensTo:["dialogOpen"]},{autoOpen:false,init:function(el,args){this._super(el,args);if(args.isNew&&args.autoOpen==="true"){this.autoOpen=true}}});CE.CtrlImageGeneral("CE.CtrlImage",{thumbnail:parent.MP.Settings.pluginRootUrl+"/"+parent.MP.Settings.pluginName+"/images/ce/imageThumbnail.png"+parent.motopress.pluginVersionParam},{id:null,init:function(el,args){this._super(el,args)},dialogOpen:function(el){if(this.autoOpen){el.find(".motopress-thumbnail-crop").trigger("click");this.autoOpen=false}},get:function(){return(this.id!==null)?this.id:""},set:function(value,defaultValue,isNew){if($.isPlainObject(value)&&value.hasOwnProperty("id")&&value.hasOwnProperty("src")){this.id=value.id;this.setThumbnail(value.src,defaultValue,isNew)}else{if($.isNumeric(value)){if(this.id===null){this.showPreloader();this.id=value;var ctrl=this;$.ajax({url:parent.motopress.ajaxUrl,type:"POST",dataType:"text",data:{action:"motopress_ce_get_attachment_thumbnail",nonce:parent.motopressCE.nonces.motopress_ce_get_attachment_thumbnail,postID:parent.motopressCE.postID,id:ctrl.id},success:function(data){ctrl.setThumbnail(data,defaultValue,isNew);ctrl.hidePreloader()},error:function(jqXHR){var error=$.parseJSON(jqXHR.responseText);if(error.debug){console.log(error.message)}else{parent.MP.Flash.setFlash(error.message,"error");parent.MP.Flash.showMessage()}ctrl.setThumbnail(CE.CtrlImage.thumbnail,defaultValue,isNew);ctrl.hidePreloader()}})}}}},setThumbnail:function(value,defaultValue,isNew){var val=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.find(".motopress-thumbnail").attr("src",val)},".motopress-thumbnail-crop click":function(el,e){if(!el.hasClass(CE.Shortcode.preloaderClass)){this.element.attr("data-motopress-open-img-lib",1);CE.ImageLibrary.myThis.frame.open()}},".motopress-icon-trash click":function(){this.id=null;this.element.find(".motopress-thumbnail").attr("src",CE.CtrlImage.thumbnail);this.hideTools();this.element.trigger("change")},showTools:function(){this.element.children(".motopress-image-tools").show()},hideTools:function(){this.element.children(".motopress-image-tools").hide()},showPreloader:function(){this.element.children(".motopress-thumbnail-crop").addClass(CE.Shortcode.preloaderClass).children(".motopress-thumbnail").css("visibility","hidden");this.hideTools()},hidePreloader:function(){var thumbnailCrop=this.element.children(".motopress-thumbnail-crop");var thumbnail=thumbnailCrop.children(".motopress-thumbnail");thumbnailCrop.removeClass(CE.Shortcode.preloaderClass);thumbnail.css("visibility","visible");if(thumbnail.attr("src")!==CE.CtrlImage.thumbnail){this.showTools()}}});CE.CtrlImageGeneral("CE.CtrlImageSlider",{},{ids:null,init:function(el,args){this._super(el,args)},dialogOpen:function(el){if(this.autoOpen){el.trigger("click");this.autoOpen=false}},get:function(){return(this.ids!==null)?this.ids:""},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);var valueType=typeof value;if(valueType==="object"){var idsStr="";var idsLen=value.length;for(var i=0;i<idsLen;i++){if(i<idsLen-1){idsStr+=value[i]+","}else{idsStr+=value[i]}}this.ids=idsStr}else{if(valueType==="number"||valueType==="string"){this.ids=$.trim(value)}}},getArray:function(){var idsArr=new Array();if(this.ids){idsArr=this.ids.split(",");var id;for(var i=0;i<idsArr.length;i++){id=parseInt(idsArr[i],10);if(id){idsArr[i]=id}else{delete idsArr[i]}}}return idsArr},click:function(el){if(!el.hasClass(CE.Shortcode.preloaderClass)){CE.WPGallery.myThis.open(this)}}});CE.Ctrl("CE.CtrlVideo",{},{init:function(el,args){this._super(el,args);this.element.on("paste",function(){var t=setTimeout(function(){el.blur();clearTimeout(t)},0)})},get:function(){return this.element.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.val(value)}});CE.Ctrl("CE.CtrlCheckbox",{},{get:function(){return this.element.is(":checked").toString()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);(value==="true")?this.element.attr("checked","checked"):this.element.removeAttr("checked")}});CE.CtrlCheckbox("CE.CtrlGroupCheckbox",{},{change:function(el,e){if(el.is(":checked")){el.closest(".motopress-property-group-accordion-item").siblings().find('.motopress-property-group-accordion-item-content > [data-motopress-parameter="'+this.name+'"] > .motopress-controls').each(function(){var ctrl=$(this).controller();if(ctrl.get()==="true"){ctrl.set("false");CE.Ctrl.prototype.change.apply(ctrl,[$(this),e])}})}CE.Ctrl.prototype.change.apply(this,[el,e])}});CE.Ctrl("CE.CtrlSelect",{listensTo:["customize"],init:function(){$("body").on("click",".motopress-property-select:not(.open) > .dropdown-toggle",function(){var menu=$(this).next();var lastIndex=menu.find("ul > li").length;lastIndex=(lastIndex>=6)?5:lastIndex-1;menu.find("li:eq("+lastIndex+") > a").focus();menu.find("ul > li > a.motopress-dropdown-selected").focus()})},setSelected:function(el){var options=el.find("option");var selectedIndex=options.index(options.filter(":selected"));var customOptions=el.next().find(".dropdown-menu > ul > li");customOptions.children("a.motopress-dropdown-selected").removeClass("motopress-dropdown-selected");customOptions.filter('[rel="'+selectedIndex+'"]').children("a").addClass("motopress-dropdown-selected")}},{get:function(){return this.element.val()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.find('[value="'+value+'"]').attr("selected","selected")},change:function(el){this._super();CE.CtrlSelect.setSelected(el)},customize:function(el){if(typeof el.data("selectpicker")!=="undefined"){el.next().remove();$.removeData(el[0],"selectpicker")}el.selectpicker({size:6});var customSelect=el.next();customSelect.removeClass("ce_ctrl_select motopress-controls");var dropdownToogle=customSelect.children(".dropdown-toggle");dropdownToogle.html(dropdownToogle.html().replace(/&nbsp;/g,""));CE.CtrlSelect.setSelected(el)}});CE.Ctrl("CE.CtrlSelect2",{listensTo:["customize"]},{isPreview:false,previewClass:null,unsetClasses:[],data:null,init:function(el,args){this._super(el,args);this.options.style=CE.LeftBar.myThis.library[this.options.instance.group].objects[this.options.instance.shortcodeName].styles.mp_style_classes},get:function(){var self=this;var data=this.element.select2("data");var result="";if(this.isPreview){data=data.filter(function(el){return $.inArray(el.id,self.unsetClasses)===-1})}data.forEach(function(el,index){if(!el.hasOwnProperty("locked")&&el.locked!==true){result+=(result!=="")?" "+el.id:el.id}});if(this.isPreview){result+=(result!=="")?" "+this.previewClass:this.previewClass}return result},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);if(!$.isEmptyObject(this.options.style.basic)){var basicClasses=this.getBasicClassesString();value=(value)?basicClasses+" "+value:basicClasses}this.options.value=value;this.element.val(value)},customize:function(el,args){var self=this;this.data=this.getClassesList();el.select2({multiple:true,separator:" ",closeOnSelect:false,createSearchChoice:function(term,data){var allowedSymbolsRegExp=/^[-_A-Za-z0-9]+$/;if(allowedSymbolsRegExp.test(term)){if($(data).filter(function(){return !this.hasOwnProperty("id")?$(this.children).filter(function(){return this.text.toUpperCase().localeCompare(term.toUpperCase())===0||this.id.toUpperCase().localeCompare(term.toUpperCase())===0}).length!==0:this.text.toUpperCase().localeCompare(term.toUpperCase())===0||this.id.toUpperCase().localeCompare(term.toUpperCase())===0}).length===0){return{id:term.toLowerCase(),text:term,custom:true}}}},initSelection:function(element,callback){callback(self.valueToData(self.options.value.split(" ")))},query:function(query){self.options.value=self.element.val();var data={};data.results=[];$.each(self.data,function(key,val){if(val.hasOwnProperty("children")){result={text:val.text,children:[]};result.children=$.makeArray(val.children.filter(function(el){return(el.id.toUpperCase().indexOf(query.term.toUpperCase())>=0||el.text.toUpperCase().indexOf(query.term.toUpperCase())>=0)&&$.inArray(el.id,self.options.value.split(" ")===-1)}));if(result.children.length){data.results.push(result)}}else{if((val.id.toUpperCase().indexOf(query.term.toUpperCase())>=0||val.text.toUpperCase().indexOf(query.term.toUpperCase())>=0)&&$.inArray(val.id,self.options.value.split(" "))===-1){data.results.push(val)}}});query.callback(data)},formatNoMatches:function(){return localStorage.getItem("CEStyleClassesFormatNoMatches")},formatResult:function(state,container){if(state.hasOwnProperty("children")){return state.text}else{if(state.hasOwnProperty("disabled")&&state.disabled){container.attr("title",localStorage.getItem("CELiteTooltipText"))}return'<i class="select2-preview-icon" data-value="'+state.id+'"></i>'+state.text}},dropdownCssClass:"select2-control-dropdown"});self.select2el=el.closest(".select2-container").find("");el.on("select2-highlight",function(e){self.unsetClasses=self.getUnsetClasses(e.val)});$(".select2-control-dropdown").off("mouseover",".select2-preview-icon").on("mouseover",".select2-preview-icon",function(){var val=$(this).attr("data-value");self.unsetClasses=self.getUnsetClasses(val);self.isPreview=true;self.setPreviewClass(val)});$(".select2-control-dropdown").off("mouseleave").on("mouseleave",".select2-preview-icon",function(){self.isPreview=false;self.unsetClasses=[];self.setPreviewClass()});el.on("select2-blur",function(e){self.isPreview=false;self.unsetClasses=[];self.setPreviewClass()});el.on("select2-close",function(e){self.isPreview=false;self.unsetClasses=[];self.setPreviewClass()});el.on("select2-selecting",function(e){self.isPreview=false;var oldValue=$(self.element).select2("val");var value=self.excludeGroupValues(oldValue);if(e.object.hasOwnProperty("custom")&&e.object.custom===true){self.data.push({id:e.object.id,text:e.object.text,custom:e.object.custom})}self.element.select2("data",self.valueToData(value))})},valueToData:function(value){var self=this;var data=[];$.each(value,function(index,val){$.each(self.data,function(el){if(self.data[el].hasOwnProperty("children")){$.each(self.data[el].children,function(el2){if(self.data[el].children[el2].id===val){data.push(self.data[el].children[el2])}})}else{if(self.data[el].id===val){data.push(self.data[el])}}})});return data},excludeGroupValues:function(value){var self=this;value=value.filter(function(el){return $.inArray(el,self.unsetClasses)===-1});return value},setPreviewClass:function(cls){this.previewClass=cls;this.options.instance.saveStyle(this)},getUnsetClasses:function(clsName){var unsetClasses=[];$.each(this.data,function(key,value){var flag=false;if(value.hasOwnProperty("children")&&(value.allowMultiple===undefined||value.allowMultiple===false)){$.each(value.children,function(key,value){if(value.id===clsName){flag=true}else{unsetClasses.push(value.id)}});if(flag){return false}else{unsetClasses=[]}}});return unsetClasses},getClassesList:function(){var predefinedClasses=this.getPredefinedClasses();var selectedClasses=this.options.value!==""?this.options.value.split(" "):[];var globalPredefinedClasses=this.getGlobalPredefinedClasses();var basicClasses=this.getBasicClasses();var classes=basicClasses.concat(globalPredefinedClasses,predefinedClasses);selectedClasses.forEach(function(el,index){if($(classes).filter(function(){var res=false;if(this.hasOwnProperty("children")){res=$(this.children).filter(function(){return this.hasOwnProperty("id")?this.id.localeCompare(el)===0:false}).length!==0}else{res=this.hasOwnProperty("id")?this.id.localeCompare(el)===0:false}return res}).length===0){classes.push({id:el,text:el})}});return classes},getBasicClasses:function(){basicClasses=[];if(!$.isEmptyObject(this.options.style.basic)){if(this.options.style.basic.hasOwnProperty("class")){basicClasses.push({id:this.options.style.basic["class"],text:this.options.style.basic.label,locked:true})}else{$.each(this.options.style.basic,function(key,value){basicClasses.push({id:value["class"],text:value.label,locked:true})})}}return basicClasses},getBasicClassesString:function(){var basicClasses=this.getBasicClasses();var result=[];$.each(basicClasses,function(key,val){result.push(val.id)});return result.join(" ")},getPredefinedClasses:function(){var result=[];if(!$.isEmptyObject(this.options.style.predefined)){var data=this.options.style.predefined;for(group in data){if(data[group].hasOwnProperty("values")){var children=[];for(el in data[group]["values"]){children.push({id:data[group]["values"][el]["class"],text:data[group]["values"][el].label,disabled:data[group]["values"][el].hasOwnProperty("disabled")&&data[group]["values"][el]["disabled"]})}result.push({text:data[group].label,children:children,allowMultiple:data[group].allowMultiple})}else{result.push({id:data[group]["class"],text:data[group]["label"],disabled:data[group].hasOwnProperty("disabled")&&data[group]["disabled"]})}}}return result},getGlobalPredefinedClasses:function(){var result=[];$.each(CE.Style.globalPredefinedClasses,function(key,value){if(value.hasOwnProperty("values")){var children=[];$.each(value.values,function(k,val){children.push({id:val["class"],text:val.label,disabled:val.hasOwnProperty("disabled")&&val.disabled})});result.push({text:value.label,children:children,allowMultiple:value.allowMultiple})}else{result.push({id:value["class"],text:value.label,disabled:value.hasOwnProperty("disabled")&&value.disabled})}});return result}});CE.Ctrl("CE.CtrlEditorButton",{},{dragHandle:null,init:function(el,args){this._super(el,args);this.dragHandle=args.shortcode.parent(".motopress-block-content").next(".motopress-helper").children(".motopress-drag-handle")},click:function(){this.dragHandle.click()}});CE.Ctrl("CE.CtrlColorPicker",{listensTo:["customize","dialogOpen"]},{lastTimerId:null,preview:null,input:null,init:function(el,args){this._super(el,args);this.preview=el.children(".motopress-property-color-picker-preview");this.input=el.children(".motopress-property-input")},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.input.val(value);if(value!==""){this.preview.css("background-color",value)}},get:function(){return this.input.val()},change:function(el,e){},dialogOpen:function(){this.input.iris("hide")},".motopress-property-input click":function(el,e){$(".motopress-property-color-picker>.motopress-property-input").iris("hide");this.input.iris("show")},".iris-palette-add click":function(el,e){var newPalettes=parent.MP.Settings.palettes;newPalettes.pop();newPalettes.unshift(this.input.iris("option","color"));$.ajax({url:parent.motopress.ajaxUrl,type:"POST",data:{action:"motopress_ce_colorpicker_update_palettes",nonce:parent.motopressCE.nonces.motopress_ce_colorpicker_update_palettes,postID:parent.motopressCE.postID,palettes:newPalettes},success:function(data){data=$.parseJSON(data);parent.MP.Settings.palettes=data.palettes;$(".motopress-property-color-picker>.motopress-property-input").iris("option","palettes",parent.MP.Settings.palettes)},error:function(jqXHR){var error=$.parseJSON(jqXHR.responseText);if(error.debug){console.log(error.message)}else{parent.MP.Flash.setFlash(error.message,"error");parent.MP.Flash.showMessage()}}})},customize:function(el,e){var self=this;this.input.iris({change:function(event,ui){self.preview.css("background-color",ui.color.toString());clearTimeout(self.lastTimerId);self.lastTimerId=setTimeout(function(){CE.Ctrl.prototype.change.apply(self,[el,e])},1000)},palettes:parent.MP.Settings.palettes,width:213})}});CE.Ctrl("CE.CtrlSlider",{},{slider:null,span:null,init:function(el,args){var self=this;this._super(el,args);this.slider=el.children(".motopress-property-slider");this.span=el.children(".motopress-property-slider-value");this.slider.slider({range:"min",min:parseInt(args.min),max:parseInt(args.max),step:parseInt(args.step),value:parseInt(args.value),slide:function(event,ui){self.span.html(ui.value)},change:function(event,ui){if(typeof event.handleObj!=="undefined"){el.trigger("change")}},disabled:args.disabled=="true"})},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.span.text(value);this.slider.slider("value",value)},get:function(){return this.slider.slider("option","value")}});CE.Ctrl("CE.CtrlRadioButtons",{},{init:function(el,args){this._super(el,args);this.element.buttonset()},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);this.element.find(":radio[value="+value+"]").attr("checked",true);this.element.find(":radio[value="+value+"]").button("refresh")},get:function(){return this.element.find(":radio:checked").val()}});CE.Ctrl("CE.CtrlGroup",{listensTo:["render"]},{currentSpan:null,shortcode:null,group:null,shortcodeName:null,label:null,accordion:null,button:null,oldItemIndex:null,init:function(el,args){this._super(el,args);this.currentSpan=args.currentSpan;this.shortcode=args.shortcode;this.group=this.shortcode.attr("data-motopress-group");this.shortcodeName=this.shortcode.attr("data-motopress-shortcode");this.label=args.label;this.accordion=el.children(".motopress-property-group-accordion");this.button=el.find("> .motopress-property-button-wrapper > .motopress-property-button-default")},render:function(el,e,isNew){this.updateLabel();var $this=this;var active=this.shortcode.attr("data-motopress-active-item");active=(isNew&&typeof active!=="undefined")?parseInt(active):false;this.accordion.accordion({active:active,header:"> div > h3",heightStyle:"content",collapsible:true,beforeActivate:function(event,ui){if(event.hasOwnProperty("originalEvent")&&event.originalEvent.hasOwnProperty("target")&&$(event.originalEvent.target).hasClass("motopress-property-group-accordion-item-remove")){event.preventDefault()}},activate:function(event,ui){var child=$this.shortcode.children("div");var index=false;if(ui.newHeader.length&&!ui.oldHeader.length||ui.newHeader.length&&ui.oldHeader.length&&!ui.newHeader.is(ui.oldHeader)){index=ui.newHeader.parent(".motopress-property-group-accordion-item").index();$this.shortcode.attr("data-motopress-active-item",index);switch($this.shortcodeName){case"mp_tabs":try{child.tabs("option","active",index)}catch(error){}break;case"mp_accordion":try{child.accordion("option","active",index)}catch(error){}break}}else{switch($this.shortcodeName){case"mp_accordion":$this.shortcode.attr("data-motopress-active-item",index);try{child.accordion("option","active",index)}catch(error){}break}}}}).sortable({axis:"y",handle:"h3 > .ui-accordion-header-icon",update:function(e,ui){var newItemIndex=ui.item.closest(".motopress-property-group-accordion-item").index();var tabs=$this.shortcode.children("div").children("[data-motopress-shortcode]");if($this.oldItemIndex<newItemIndex){tabs.eq($this.oldItemIndex).insertAfter(tabs.eq(newItemIndex))}else{tabs.eq($this.oldItemIndex).insertBefore(tabs.eq(newItemIndex))}el.trigger("change")},start:function(e,ui){$this.oldItemIndex=ui.item.closest(".motopress-property-group-accordion-item").index()}});if(this.disabled){if(!isNew||isNew&&this.accordion.children(".motopress-property-group-accordion-item").length){this.button.attr("disabled",true)}}},change:function(el,e,isNew){this.updateLabel();var $this=this;var childShortcodes=this.shortcode.children("div").children("[data-motopress-shortcode]");var content="";childShortcodes.each(function(){if(isNew&&$(this).attr("data-motopress-new")==="true"){var parameters=(typeof $(this).attr("data-motopress-parameters")!=="undefined")?$(this).attr("data-motopress-parameters"):null;var styles=(typeof $(this).attr("data-motopress-styles")!=="undefined")?$(this).attr("data-motopress-styles"):null;var ctrl=$this.currentSpan.controller();ctrl.setDefaultAttrs(parameters,$(this));ctrl.setDefaultStyle(styles);$(this).removeAttr("data-motopress-new")}content=parent.CE.Save.getShortcode(content,$(this))});this.shortcode.attr("data-motopress-content",content);CE.Ctrl.prototype.change.apply(this,[el,e])},"> .motopress-property-button-wrapper > .motopress-property-button-default click":function(el,e,count){e.stopPropagation();if(!this.disabled||typeof count!=="undefined"){var newItem=$("<div />",{"data-motopress-new":"true"});var attrs=null;switch(this.shortcodeName){case"mp_tabs":attrs=CE.LeftBar.myThis.library[this.group].objects.mp_tab;break;case"mp_accordion":attrs=CE.LeftBar.myThis.library[this.group].objects.mp_accordion_item;break}if(attrs!==null){CE.LeftBar.myThis.setAttrs(newItem,this.group,attrs)}if(typeof count!=="undefined"){var newItems=$();for(var i=0;i<count;i++){newItems=newItems.add(newItem.clone())}newItem=newItems}var child=this.shortcode.children("div");child.append(newItem);if(typeof count==="undefined"){var active=child.children("[data-motopress-shortcode]").index($(newItem).eq(-1));this.shortcode.attr("data-motopress-active-item",active)}var ctrl=this.currentSpan.controller();ctrl.generateSettingsForms(undefined,undefined,this.name);ctrl.displaySettings(true,undefined,undefined,this.name,true)}},".motopress-property-group-accordion-item-remove click":function(el,e){e.stopPropagation();var index=el.closest(".motopress-property-group-accordion-item").index();this.shortcode.children("div").children("[data-motopress-shortcode]:eq("+index+")").remove();this.shortcode.removeAttr("data-motopress-active-item");var ctrl=this.currentSpan.controller();ctrl.generateSettingsForms(undefined,undefined,this.name);ctrl.displaySettings(false,undefined,undefined,this.name,true)},updateLabel:function(){if(this.label.hasOwnProperty("parameter")){var $this=this;this.accordion.find(".motopress-property-group-accordion-item-label-text").each(function(){var el=$(this).parent(".motopress-property-group-accordion-item-label").next(".motopress-property-group-accordion-item-content").find('[data-motopress-parameter="'+$this.label.parameter+'"] > .motopress-controls, [data-motopress-parameter="'+$this.label.parameter+'"] > :not(".motopress-property-label, .motopress-property-description, hr") > .motopress-controls');if(el.length){$(this).text(el.controller().get())}})}}});CE.Ctrl("CE.CtrlMargin",{},{margin:null,init:function(el,args){this._super(el,args);this.margin=args.margin},get:function(){var margin=[];var $this=this;var allNone=true;var $this=this;$.each($this.margin.sides,function(i,side){var val=$this.element.find('[data-motopress-margin-side="'+side+'"] .'+$this.margin.classPrefix+"value").text();margin.push(val);if(val!==$this.margin.values[0]){allNone=false}});return(allNone)?"":margin.join(",")},set:function(value,defaultValue,isNew){value=CE.Ctrl.processValue(value,defaultValue,isNew);if(typeof value==="string"){if(!value.length){return}value=value.split(",")}var $this=this;$.each(value,function(i,val){var intVal=parseInt(val);if(!isNaN(intVal)){val=intVal}var tr=$this.element.find('[data-motopress-margin-side="'+$this.margin.sides[i]+'"]');var icon=tr.find("."+$this.margin.classPrefix+"icon");var valueEl=tr.find("."+$this.margin.classPrefix+"value");var values=tr.find("."+$this.margin.classPrefix+"values");valueEl.text(val);values.removeAttr("data-motopress-margin-disabled");values.filter('[data-motopress-margin-value="'+val+'"]').attr("data-motopress-margin-disabled","");if(val!==$this.margin["default"][i]){icon.attr("data-motopress-margin-active","");valueEl.attr("data-motopress-margin-active","")}else{icon.removeAttr("data-motopress-margin-active");valueEl.removeAttr("data-motopress-margin-active")}})},".motopress-margin-values click":function(el){if(typeof el.attr("data-motopress-margin-disabled")==="undefined"){var tr=el.closest("[data-motopress-margin-side]");var index=tr.index();var icon=tr.find("."+this.margin.classPrefix+"icon");var valueEl=tr.find("."+this.margin.classPrefix+"value");var values=tr.find("."+this.margin.classPrefix+"values");var val=el.text();var intVal=parseInt(val);if(!isNaN(intVal)){val=intVal}valueEl.text(val);values.removeAttr("data-motopress-margin-disabled");el.attr("data-motopress-margin-disabled","");if(val!==this.margin["default"][index]){icon.attr("data-motopress-margin-active","");valueEl.attr("data-motopress-margin-active","")}else{icon.removeAttr("data-motopress-margin-active");valueEl.removeAttr("data-motopress-margin-active")}this.element.trigger("change")}},getClasses:function(value){var marginClasses=[];if(typeof value!=="undefined"&&value.length){if(typeof value==="string"){value=value.split(",")}var uniqueValues=[];$.each(value,function(i,val){if($.inArray(val,uniqueValues)===-1){uniqueValues.push(val)}});var isSame=(uniqueValues.length===1)?true:false;if(value.length===4&&isSame&&uniqueValues[0]!==this.margin.values[0]){marginClasses.push(this.margin.classPrefix+uniqueValues[0])}else{var $this=this;$.each(value,function(i,val){if(val!==$this.margin["default"][i]){marginClasses.push($this.margin.classPrefix+$this.margin.sides[i]+"-"+val)}})}}return marginClasses.join(" ")}})});